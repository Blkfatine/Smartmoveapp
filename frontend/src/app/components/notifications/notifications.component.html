<div class="notif-wrapper">
    <!-- Background Decor -->
    <div class="bg-shape shape-1"></div>
    <div class="bg-shape shape-2"></div>

    <div class="container">
        <!-- Header Section -->
        <header class="page-header animate-fade-in">
            <div class="title-group">
                <h1 class="page-title">üîî Vos Notifications</h1>
                <p class="page-subtitle">Restez inform√© des conditions de route et des pr√©visions en temps r√©el.</p>
            </div>
            <div class="live-status">
                <span class="live-badge">
                    <span class="pulse-dot"></span>
                    En Direct
                </span>
            </div>
        </header>

        <!-- Notifications List -->
        <div class="notif-container" *ngIf="notifications.length > 0; else emptyState">
            <div *ngFor="let n of notifications; let i = index" class="notif-card animate-slide-up"
                [style.animation-delay]="i * 0.1 + 's'" [class]="n.type.toLowerCase()">
                <div class="card-glow"></div>
                <div class="card-inner">
                    <div class="status-indicator"></div>

                    <div class="icon-section">
                        <span class="type-icon" *ngIf="n.type === 'TRAFFIC'">üöß</span>
                        <span class="type-icon" *ngIf="n.type === 'WEATHER'">üåßÔ∏è</span>
                        <span class="type-icon" *ngIf="n.type === 'INCIDENT'">‚ö†Ô∏è</span>
                    </div>

                    <div class="content-section">
                        <div class="card-meta">
                            <span class="type-badge" [class]="n.type.toLowerCase()">{{ n.type }}</span>
                            <span class="timestamp">{{ n.timestamp | date:'dd MMM, HH:mm' }}</span>
                        </div>
                        <h3 class="notif-title">{{ n.title }}</h3>
                        <p class="notif-message">{{ n.message }}</p>
                    </div>

                    <div class="action-section">
                        <button class="detail-btn" (click)="openDetails(n)">D√©tails</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Details Modal Overlay -->
        <div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
            <div class="modal-card animate-zoom-in" (click)="$event.stopPropagation()">
                <div class="modal-header">
                    <div class="type-pill" [class]="selectedNotification?.type?.toLowerCase()">
                        {{ selectedNotification?.type }}
                    </div>
                    <button class="close-icon" (click)="closeModal()">√ó</button>
                </div>

                <div class="modal-body" *ngIf="selectedNotification">
                    <div class="modal-main-info">
                        <h2>{{ selectedNotification.title }}</h2>
                        <p class="time">{{ selectedNotification.timestamp | date:'HH:mm - dd MMMM yyyy' }}</p>
                    </div>

                    <div class="map-preview" *ngIf="selectedNotification.details?.mapUrl">
                        <img [src]="selectedNotification.details?.mapUrl" alt="Map snapshot">
                        <div class="map-overlay">
                            <span>IA Analysis View</span>
                        </div>
                    </div>

                    <div class="ai-suggestion">
                        <div class="ai-header">
                            <span class="ai-icon">ü§ñ</span>
                            <h4>Analyse & Recommandation IA</h4>
                        </div>
                        <p>{{ selectedNotification.details?.suggestion || 'Analyse en cours...' }}</p>
                    </div>

                    <div class="metrics-grid">
                        <div class="metric-item" *ngFor="let metric of selectedNotification.details?.metrics">
                            <span class="metric-val">{{ metric }}</span>
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button class="action-primary" (click)="closeModal()">J'ai compris</button>
                </div>
            </div>
        </div>

        <!-- Empty State -->
        <ng-template #emptyState>
            <div class="empty-box animate-fade-in delay-2">
                <div class="empty-icon-wrapper">
                    <span class="empty-stars">‚ú®</span>
                    <div class="ia-pulse"></div>
                </div>
                <h3 class="empty-title">Aucune notification</h3>
                <p class="empty-text">Tout est calme sur vos trajets. Votre IA de mobilit√© veille sur vous.</p>
                <button class="refresh-btn" (click)="ngOnInit()">Actualiser</button>
            </div>
        </ng-template>
    </div>
</div>